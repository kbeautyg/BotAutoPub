# TELEGRAM BOT - POST PUBLISHING SYSTEM

## ПРОБЛЕМА
При публикации постов с форматированием Markdown возникают ошибки:
- ❌ Character '-' is reserved and must be escaped with the preceding '\'
- ❌ Character '.' is reserved and must be escaped with the preceding '\'
- ❌ Can't find end of the entity starting at byte offset [число]

## АНАЛИЗ ПРОБЛЕМЫ
Функция `clean_text_for_format` в `view_post.py` неправильно экранирует специальные символы для Telegram MarkdownV2 API.

## ПЛАН ИСПРАВЛЕНИЯ
1. ✅ Изучить структуру приложения - это Telegram бот для управления постами
2. ✅ Исправить функцию экранирования Markdown символов
3. ⏳ Протестировать исправления
4. ⏳ Убедиться что публикация работает корректно

## НАЙДЕННЫЕ ФАЙЛЫ
- `/app/main.py` - основной файл бота с функциями публикации
- `/app/view_post.py` - функции форматирования текста (здесь проблема)
- `/app/auto_post_fixed.py` - планировщик постов
- `/app/edit_post.py` - редактирование постов

## ВЫПОЛНЕННЫЕ ИСПРАВЛЕНИЯ ✅
1. **Исправлена функция `clean_text_for_format`**:
   - Вынесена логика MarkdownV2 в отдельную функцию `escape_markdown_v2_properly`
   - Упрощен основной код функции

2. **Исправлен порядок экранирования символов**:
   - Символ `\` (backslash) теперь экранируется первым
   - Это предотвращает двойное экранирование других символов

3. **Обновлена функция `escape_markdown_v2_text`**:
   - Правильный порядок экранирования специальных символов
   - Включены все необходимые символы для MarkdownV2

## СТАТУС
✅ Исправления внесены в код - функция экранирования Markdown улучшена

## Testing Protocol
При тестировании обязательно проверить:
1. Публикацию постов с символами `-`, `_`, `*`, `[`, `]`, `(`, `)`, `.`, `!`
2. Корректность отображения форматирования
3. Что публикация не падает с ошибками парсинга
4. Посты с эмодзи и символами на русском языке
5. Длинные посты с различными специальными символами